!pip install -U python-telegram-bot

import os
import random 

BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN", "7296723491:AAEcK3GzEDuFX8zrml68dMZ7vifGa1hXJio")

from telegram import (
    Update,
    ReplyKeyboardMarkup,
    KeyboardButton,
    InlineKeyboardMarkup,
    InlineKeyboardButton,
)
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    CallbackQueryHandler,
    ContextTypes,
    filters,
)


async def run():
    await app.initialize()
    await app.start()
    print("‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –ù–∞–ø–∏—à–∏ –µ–º—É /start –≤ Telegram.")
    try:
        await app.updater.start_polling()
        # –¥–µ—Ä–∂–∏–º –ø—Ä–æ—Ü–µ—Å—Å ¬´–≤–µ—á–Ω–æ¬ª
        await asyncio.Event().wait()
    finally:
        # –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
        await app.updater.stop()
        await app.stop()
        await app.shutdown()

await run()

# –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

from getpass import getpass
import nest_asyncio, asyncio, logging
from telegram import Update
from telegram.ext import ApplicationBuilder, CommandHandler, ContextTypes

# —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —à—Ç—É–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ Colab:
nest_asyncio.apply()
logging.basicConfig(level=logging.INFO)

# –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–ü—Ä–∏–≤–µ—Ç! –Ø –∑–∞–ø—É—â–µ–Ω –≤ Colab —á–µ—Ä–µ–∑ polling üêç")

async def help_cmd(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–ö–æ–º–∞–Ω–¥—ã: /start /help")

async def about(update: Update, context: ContextTypes.DEFAULT_TYPE):
  await update.message.reply_text("–ö–æ–º–∞–Ω–¥—ã: ‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω. –ù–∞–ø–∏—à–∏ –µ–º—É /start –≤ Telegram.")

async def hello(update: Update, context: ContextTypes.DEFAULT_TYPE):
  await update.message.reply_text("hiiiiiii")

# —Å–æ–∑–¥–∞–Ω–∏–µ Application –∏ –∫–Ω–æ–ø–æ–∫
app = ApplicationBuilder().token(BOT_TOKEN).build()
app.add_handler(CommandHandler("start", start))
app.add_handler(CommandHandler("help", help_cmd))
app.add_handler(CommandHandler("about",about))
app.add_handler(CommandHandler("hello",hello))

#–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä—ã

from telegram.ext import MessageHandler, filters

async def echo(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text
    await update.message.reply_text(f"–¢—ã —Å–∫–∞–∑–∞–ª: {text}")

async def communicate(update: Update, context: ContextTypes.DEFAULT_TYPE):
    flag = False
    text = update.message.text

    if "Hello" in text :
      flag = True
      #text = update.message.text
      await update.message.reply_text(f"Hiiii")

    if "How are you" in text:
      flag = True
      await update.message.reply_text(f"üòä")

    if "Bye" in text:
      flag = True
      await update.message.reply_text(f"Bye üëã ")

    if "About" in text:
      flag = True
      await update.message.reply_text(f"This bot was created for learning ")

    if flag == False:
      await update.message.reply_text(f"Unefortunately, I haven't learnt to answer on it yet")

    if "Derivative" in text:
      flag = True

#app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo))
app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, communicate))

# menu

from telegram import ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import CommandHandler

reply_kb = ReplyKeyboardMarkup(
    keyboard=[
        [KeyboardButton("Hello"), KeyboardButton("Bye")],
        [KeyboardButton("How are you?")],
        [KeyboardButton("About")],
        [KeyboardButton( "Derivative")]
    ],
    resize_keyboard=True
)

#What is you attitude to bot's creating?

async def menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–í—ã–±–µ—Ä–∏—Ç–µ –∫–Ω–æ–ø–∫—É:", reply_markup=reply_kb)

app.add_handler(CommandHandler("menu", menu))

from telegram.ext import CommandHandler
async def question(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤–æ–ø—Ä–æ—Å —Å –∫–Ω–æ–ø–∫–∞–º–∏ –î–∞ / –ù–µ—Ç."""
    keyboard = [
        [
            InlineKeyboardButton("–î–∞", callback_data="answer_yes"),
            InlineKeyboardButton("–ù–µ—Ç", callback_data="answer_no"),
        ]
    ]
    markup = InlineKeyboardMarkup(keyboard)

    await update.message.reply_text(
        "–¢–µ–±–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –ø–∏—Å–∞—Ç—å –±–æ—Ç–æ–≤ –Ω–∞ Python?", reply_markup=markup
    )


async def handle_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ inline-–∫–Ω–æ–ø–∫–∏."""
    query = update.callback_query
    await query.answer()  # –æ—Ç–≤–µ—á–∞–µ–º Telegram, —á—Ç–æ –≤—Å—ë –æ–∫ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —à–∞–≥)

    if query.data == "answer_yes":
        text = "–ö—Ä—É—Ç–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ üíªüî•"
    elif query.data == "answer_no":
        text = "–ü–æ–Ω–∏–º–∞—é, –Ω–µ –≤—Å–µ–≥–¥–∞ –≤—Å—ë —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—Ç—Å—è. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ —Å–¥–∞–≤–∞—Ç—å—Å—è üôÇ"
    else:
        text = "–°—Ç—Ä–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç, –Ω–æ —è –µ–≥–æ —É–≤–∞–∂–∞—é üòÑ"

    # –ú–æ–∂–Ω–æ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
    await query.edit_message_text(text)


app.add_handler(CommandHandler("question", question))

# how are you?

async def mood(update: Update, context: ContextTypes.DEFAULT_TYPE):

  keyboard = [
        [
            InlineKeyboardButton("Perfect", callback_data="answer_perfect"),
            InlineKeyboardButton("Bad", callback_data="answer_bad"),
        ]
    ]
  markup = InlineKeyboardMarkup(keyboard)

  await update.message.reply_text(
        "How is your mood?", reply_markup=markup
  )


async def handle_callback(update: Update, context: ContextTypes.DEFAULT_TYPE):

    query = update.callback_query
    await query.answer()

    if query.data == "answer_perfect":
        text = "So cool!"
    elif query.data == "answer_no":
        text = "Even superheroes get sad sometimes "
    else:
        text = "There is no better moment then now"

    await query.edit_message_text(text)


app.add_handler(CommandHandler("mood", mood))

#sending photoes

photo_massive=[("https://candlescience.ru/wp-content/uploads/2024/10/Green_Leaves.webp"),
               ("https://hips.hearstapps.com/hmg-prod/images/autumn-fall-foliage-leaves-change-colors-to-orange-and-red-news-photo-1667589874.jpg?crop=1.00xw:0.708xh;0,0.154xh&resize=1200:*"),
               ("https://images.stockcake.com/public/1/c/8/1c89bbc8-eb46-4d4b-9ad4-07ad46581641_large/frosted-winter-leaves-stockcake.jpg")
               ]  # —Å–ª—É—á–∞–π–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞

async def send_photo(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–ü—Ä–∏—Å—ã–ª–∞–µ–º —Ñ–æ—Ç–æ –ø–æ URL."""
    await update.message.reply_photo(
        photo=random.choice(photo_massive),
        caption="–í–æ—Ç —Å–ª—É—á–∞–π–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ üì∑",
    )

app.add_handler(CommandHandler("sendphoto", send_photo))

